{% extends 'base.html' %}
{% load static %}

{% block title %}All Products - SnapNShop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/allProduct.css' %}">
<link rel="stylesheet" href="{% static 'css/card.css' %}">
{% endblock %}

{% block content %}
<section class="products-section py-5">
    <div class="container">
        <!-- Header -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="products-header text-center">
                    <h1 class="products-title">Discover Amazing Products</h1>
                    <p class="products-subtitle">Explore our curated collection of quality products</p>
                    
                </div>
            </div>
        </div>

        <!-- Filters & Search -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="search-box">
                    <input type="text" class="form-control" id="searchProducts" placeholder="Search products...">
                    <i class="bi bi-search search-icon"></i>
                </div>
            </div>
            <div class="col-md-6">
                <div class="filter-dropdown">
                    <select class="form-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="men's clothing">Men's Clothing</option>
                        <option value="women's clothing">Women's Clothing</option>
                        <option value="electronics">Electronics</option>
                        <option value="jewelery">Jewelry</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        {% if error %}
            <div class="row">
                <div class="col-12">
                    <div class="alert alert-danger text-center">
                        <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
                    </div>
                </div>
            </div>
        {% else %}
            <div class="row g-4" id="productsGrid">
                {% for product in products %}
                    {% include 'product/card.html' with product=product %}
                {% empty %}
                    <div class="col-12">
                        <div class="empty-state text-center py-5">
                            <i class="bi bi-box display-1 text-muted"></i>
                            <h3 class="text-muted mt-3">No products found</h3>
                            <p class="text-muted">Try adjusting your search or filters</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Loading Spinner -->
        <div class="text-center mt-4">
            <div id="loadingSpinner" class="spinner-border text-primary d-none" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
</section>

<!-- Toast for notifications -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="productToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong class="me-auto">SnapNShop</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage">
            Product added successfully!
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/card.js' %}"></script>
<script>
    // Search functionality
    document.getElementById('searchProducts').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        filterProducts();
    });

    // Category filter
    document.getElementById('categoryFilter').addEventListener('change', function() {
        filterProducts();
    });

    function filterProducts() {
        const searchTerm = document.getElementById('searchProducts').value.toLowerCase();
        const selectedCategory = document.getElementById('categoryFilter').value.toLowerCase();
        const productCards = document.querySelectorAll('.product-card-wrapper');

        productCards.forEach(card => {
            const title = card.querySelector('.card-title').textContent.toLowerCase();
            const category = card.querySelector('.card-category').textContent.toLowerCase();
            
            const matchesSearch = title.includes(searchTerm);
            const matchesCategory = !selectedCategory || category.includes(selectedCategory);
            
            if (matchesSearch && matchesCategory) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}